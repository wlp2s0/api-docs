(self.webpackChunkdev_rev_docs=self.webpackChunkdev_rev_docs||[]).push([[5136],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return m},kt:function(){return p}});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),l=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),d=l(a),p=n,h=d["".concat(s,".").concat(p)]||d[p]||u[p]||o;return a?r.createElement(h,i(i({ref:t},m),{},{components:a})):r.createElement(h,i({ref:t},m))}));function p(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<o;l++)i[l]=a[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},8215:function(e,t,a){"use strict";var r=a(7294);t.Z=function(e){var t=e.children,a=e.hidden,n=e.className;return r.createElement("div",{role:"tabpanel",hidden:a,className:n},t)}},5064:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var r=a(7294),n=a(9443);var o=function(){var e=(0,r.useContext)(n.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=a(6010),c="tabItem_1uMI",s="tabItemActive_2DSg";var l=37,m=39;var u=function(e){var t=e.lazy,a=e.block,n=e.defaultValue,u=e.values,d=e.groupId,p=e.className,h=o(),f=h.tabGroupChoices,v=h.setTabGroupChoices,k=(0,r.useState)(n),y=k[0],g=k[1],b=r.Children.toArray(e.children),N=[];if(null!=d){var w=f[d];null!=w&&w!==y&&u.some((function(e){return e.value===w}))&&g(w)}var C=function(e){var t=e.currentTarget,a=N.indexOf(t),r=u[a].value;g(r),null!=d&&(v(d,r),setTimeout((function(){var e,a,r,n,o,i,c,l;(e=t.getBoundingClientRect(),a=e.top,r=e.left,n=e.bottom,o=e.right,i=window,c=i.innerHeight,l=i.innerWidth,a>=0&&o<=l&&n<=c&&r>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(s),setTimeout((function(){return t.classList.remove(s)}),2e3))}),150))},x=function(e){var t,a;switch(e.keyCode){case m:var r=N.indexOf(e.target)+1;a=N[r]||N[0];break;case l:var n=N.indexOf(e.target)-1;a=N[n]||N[N.length-1]}null==(t=a)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},p)},u.map((function(e){var t=e.value,a=e.label;return r.createElement("li",{role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,className:(0,i.Z)("tabs__item",c,{"tabs__item--active":y===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:x,onFocus:C,onClick:C},a)}))),t?(0,r.cloneElement)(b.filter((function(e){return e.props.value===y}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},b.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==y})}))))}},9443:function(e,t,a){"use strict";var r=(0,a(7294).createContext)(void 0);t.Z=r},8858:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return m},metadata:function(){return u},toc:function(){return d},default:function(){return h}});var r=a(2122),n=a(9756),o=(a(7294),a(3905)),i=a(5064),c=a(8215),s=["components"],l={sidebar_position:3},m="Charge a customer\u2019s saved payment method",u={unversionedId:"accept-payments/tutorials/charge-saved-payment-method",id:"accept-payments/tutorials/charge-saved-payment-method",isDocsHomePage:!1,title:"Charge a customer\u2019s saved payment method",description:"You can save your customers\u2019 card details to be able to charge them at a later time. This is useful in the following use cases:",source:"@site/docs/accept-payments/tutorials/charge-saved-payment-method.md",sourceDirName:"accept-payments/tutorials",slug:"/accept-payments/tutorials/charge-saved-payment-method",permalink:"/docs/accept-payments/tutorials/charge-saved-payment-method",version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docs",previous:{title:"Accept payments via Revolut Pay",permalink:"/docs/accept-payments/tutorials/accept-payments-via-revolut-pay"},next:{title:"Authorize an amount to capture later",permalink:"/docs/accept-payments/tutorials/capture-later"}},d=[{value:"1. Save the card details of a customer",id:"1-save-the-card-details-of-a-customer",children:[{value:"Create a customer first",id:"create-a-customer-first",children:[]},{value:"Create an order first",id:"create-an-order-first",children:[]}]},{value:"2. Charge the saved payment method",id:"2-charge-the-saved-payment-method",children:[]}],p={toc:d};function h(e){var t=e.components,a=(0,n.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"charge-a-customers-saved-payment-method"},"Charge a customer\u2019s saved payment method"),(0,o.kt)("p",null,"You can save your customers\u2019 card details to be able to charge them at a later time. This is useful in the following use cases:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"When you charge for subscriptions, or recurring transactions."),(0,o.kt)("li",{parentName:"ul"},"When you want to simplify the checkout experience for your customers, so that they can select a previously used card instead of having to enter its details again.")),(0,o.kt)("p",null,"To do that, you:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Save the card details of a customer."),(0,o.kt)("li",{parentName:"ol"},"Charge the customer\u2019s saved payment method.")),(0,o.kt)("h2",{id:"1-save-the-card-details-of-a-customer"},"1. Save the card details of a customer"),(0,o.kt)("p",null,"There are two approaches to save the card details of a customer:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Create a customer first")," and attach the payment method to the customer after the payment is made."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Create an order first")," and attach the payment method to the customer created after the order is completed.")),(0,o.kt)("h3",{id:"create-a-customer-first"},"Create a customer first"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a ",(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/createCustomer",target:"_blank"},"customer")," and note down the ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," of the customer object."),(0,o.kt)("li",{parentName:"ol"},"Create an ",(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/createOrder",target:"_blank"},"order")," with the ",(0,o.kt)("inlineCode",{parentName:"li"},"amount"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"currency"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"customer_id")," parameters in the body of the request."),(0,o.kt)("li",{parentName:"ol"},"Make the payment via the Revolut Checkout Widget with ",(0,o.kt)("inlineCode",{parentName:"li"},"options.savePaymentMethodFor")," = ",(0,o.kt)("inlineCode",{parentName:"li"},"customer")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"merchant"),"."),(0,o.kt)("li",{parentName:"ol"},"Payment method is created and attached to the customer.")),(0,o.kt)("h3",{id:"create-an-order-first"},"Create an order first"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/createOrder",target:"_blank"},"Create an order")," with the `amount` and `currency` parameters."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Make the payment via the Revolut Checkout Widget with ",(0,o.kt)("inlineCode",{parentName:"p"},"options.savePaymentMethodFor")," = ",(0,o.kt)("inlineCode",{parentName:"p"},"customer")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"merchant"),". "),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"email")," must be provided when you create an order or when the customer is making the payment; otherwise, an error is returned.")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"When the payment is successful, a ",(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/createCustomer",target:"_blank"},"customer")," is created with the email.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Payment method is associated with the customer and ",(0,o.kt)("inlineCode",{parentName:"p"},"customer_id")," is attached to the order automatically."))),(0,o.kt)("div",{class:"feedback"}),(0,o.kt)("h2",{id:"2-charge-the-saved-payment-method"},"2. Charge the saved payment method"),(0,o.kt)("p",null,"When you\u2019ve created a customer and saved the customer\u2019s payment method successfully, you can charge this payment method later without the customer being on the checkout page, for example, to charge for recurring transactions. You can also use this approach to speed up the checkout process when the customer is on the checkout page, for example, for 1-click buy flow."),(0,o.kt)("p",null,"Complete the following steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/createOrder",target:"_blank"},"Create an order")," with the ",(0,o.kt)("code",null,"amount"),", ",(0,o.kt)("code",null,"currency")," and ",(0,o.kt)("code",null,"customer_id")," parameters in the body of the request:")),(0,o.kt)(i.Z,{defaultValue:"prod",values:[{label:"Production",value:"prod"},{label:"Sandbox",value:"sandbox"}],mdxType:"Tabs"},(0,o.kt)(c.Z,{value:"prod",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X "POST" "https://merchant.revolut.com/api/1.0/orders" \\\n    -H \'Authorization: Bearer [yourApiKey]\' \\\n    -H \'Content-Type: application/json; charset=utf-8\' \\\n    -d $\'{\n          "amount": 100,\n          "currency": "GBP",\n          "customer_id": "6c7c97a8-cfc1-4cf3-8b38-26a74fdf1fae"\n        }\'\n'))),(0,o.kt)(c.Z,{value:"sandbox",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X "POST" "https://sandbox-merchant.revolut.com/api/1.0/orders" \\\n    -H \'Authorization: Bearer [yourSandboxApiKey]\' \\\n    -H \'Content-Type: application/json; charset=utf-8\' \\\n    -d $\'{\n          "amount": 100,\n          "currency": "GBP",\n          "customer_id": "6c7c97a8-cfc1-4cf3-8b38-26a74fdf1fae"\n        }\'\n')))),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/confirmOrder",target:"_blank"},"Confirm the order")," to take payment from this customer using the saved payment method:")),(0,o.kt)(i.Z,{defaultValue:"prod",values:[{label:"Production",value:"prod"},{label:"Sandbox",value:"sandbox"}],mdxType:"Tabs"},(0,o.kt)(c.Z,{value:"prod",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"curl -X \"POST\" \"https://merchant.revolut.com/api/1.0/orders/{:orderId}/confirm\" \\\n    -H 'Authorization: Bearer [yourApiKey]' \\\n    -H 'Content-Type: application/json; charset=utf-8' \\\n"))),(0,o.kt)(c.Z,{value:"sandbox",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"curl -X \"POST\" \"https://sandbox-merchant.revolut.com/api/1.0/orders/{:orderId}/confirm\" \\\n    -H 'Authorization: Bearer [yourSandboxApiKey]' \\\n    -H 'Content-Type: application/json; charset=utf-8' \\\n")))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"If ",(0,o.kt)("code",null,"payment_method_id")," is specified in the body of the ",(0,o.kt)("a",{href:"https://developer.revolut.com/api-reference/merchant/#operation/confirmOrder",target:"_blank"},"order confirmation request"),", the value of this parameter is used to make the payment for the order."),(0,o.kt)("li",{parentName:"ul"},"If ",(0,o.kt)("inlineCode",{parentName:"li"},"payment_method_id")," is not specified, the value of this parameter is taken from the payment method that was last saved for the customer with ",(0,o.kt)("inlineCode",{parentName:"li"},"saved_for"),"= ",(0,o.kt)("inlineCode",{parentName:"li"},"MERCHANT"),".")))),(0,o.kt)("div",{className:"admonition admonition-success alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"success")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"Congratulations"),"! You\u2019ve successfully charged a saved payment method from one of your customers."))),(0,o.kt)("div",{class:"feedback"}))}h.isMDXComponent=!0},6010:function(e,t,a){"use strict";function r(e){var t,a,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=r(e[t]))&&(n&&(n+=" "),n+=a);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function n(){for(var e,t,a=0,n="";a<arguments.length;)(e=arguments[a++])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}a.d(t,{Z:function(){return n}})}}]);